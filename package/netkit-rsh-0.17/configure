#!/bin/sh
#
# This file was generated by confgen version 2.
# Do not edit.
#

PREFIX='/usr'
#EXECPREFIX='$PREFIX'
INSTALLROOT=''
BINMODE='755'
#DAEMONMODE='$BINMODE'
MANMODE='644'
SUIDMODE='4755'

while [ x$1 != x ]; do case $1 in

	--help)
	cat <<EOF
Usage: configure [options]
    --help                Show this message
    --with-debug          Enable debugging
    --without-pam      Disable PAM support
    --without-shadow      Disable shadow password support
    --prefix=path         Prefix for location of files [/usr]
    --exec-prefix=path    Location for arch-depedent files [prefix]
    --installroot=root    Top of filesystem tree to install in [/]
    --binmode=mode        Mode for binaries [755]
    --daemonmode=mode     Mode for daemon binaries [same as binmode]
    --manmode=mode        Mode for manual pages [644]
    --suidmode=mode       Mode for setuid programs [4755]
    --with-c-compiler=cc  Program for compiling C source [guessed]
EOF
	exit 0;;
	--verbose) ;;
	--quiet) ;;

	--subdir) . ../configure.defs;;

	--with-debug|--debug) DEBUG=1;;
	--prefix=*) PREFIX=`echo $1 | sed 's/^[^=]*=//'` ;;
	--exec-prefix=*) EXECPREFIX=`echo $1 | sed 's/^[^=]*=//'` ;;
	--installroot=*) INSTALLROOT=`echo $1 | sed 's/^[^=]*=//'` ;;
	--binmode=*) BINMODE=`echo $1 | sed 's/^[^=]*=//'` ;;
	--daemonmode=*) DAEMONMODE=`echo $1 | sed 's/^[^=]*=//'` ;;
	--manmode=*) MANMODE=`echo $1 | sed 's/^[^=]*=//'` ;;
	--suidmode=*) SUIDMODE=`echo $1 | sed 's/^[^=]*=//'` ;;
	--with-c-compiler=*) CC=`echo $1 | sed 's/^[^=]*=//'` ;;
	--without-pam|--disable-pam) WITHOUT_PAM=1;;
	--without-shadow|--disable-shadow) WITHOUT_SHADOW=1;;
	*) echo "Unrecognized option: $1"; exit 1;;
esac 
shift
done

if [ x$EXECPREFIX = x ]; then 
	EXECPREFIX="$PREFIX"
fi

if [ x$DAEMONMODE = x ]; then 
	DAEMONMODE="$BINMODE"
fi

BINDIR="$EXECPREFIX/bin"
SBINDIR="$EXECPREFIX/sbin"
MANDIR="$PREFIX/man"

echo "Directories: $BINDIR $SBINDIR $MANDIR "

if [ x$INSTALLROOT != x ]; then
    echo "Installing in chroot tree rooted at $INSTALLROOT"
fi

##################################################

WARNINGS='-Wall -W -Wpointer-arith -Wbad-function-cast -Wcast-qual -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations -Wnested-externs -Winline '

cat << EOF > __conftest.c
    int main(void) { int class=0; return class; }
EOF

if [ x"$CC" = x ]; then
    echo -n 'Looking for a C compiler... '
    for TRY in egcs gcc g++ CC c++ cc; do
       (
           $TRY __conftest.c -o __conftest || exit 1;
           ./__conftest || exit 1;
       ) >/dev/null 2>&1 || continue;
       CC=$TRY
       break;
    done
    if [ x"$CC" = x ]; then
        echo 'failed.'
        echo 'Cannot find a C compiler. Run configure with --with-c-compiler.'
        rm -f __conftest*
        exit
    fi
    echo "$CC"
fi

echo -n "Checking if $CC accepts gcc warnings... "
if (
    $CC $WARNINGS __conftest.c -o __conftest || exit 1
   ) >/dev/null 2>&1; then
     echo 'yes'
     CC_WARNINGS=1
else
     echo 'no'
fi

if [ x$DEBUG = x ]; then
    echo -n "Checking if $CC accepts -O2... "
    if (
         $CC -O2 __conftest.c -o __conftest
       ) >/dev/null 2>&1; then
         echo 'yes'
         CFLAGS="$CFLAGS -O2"
    else
         echo 'no'
         echo -n "Checking if $CC accepts -O... "
         if (
              $CC -O __conftest.c -o __conftest
            ) >/dev/null 2>&1; then
              echo 'yes'
              CFLAGS="$CFLAGS -O"
         else
              echo 'no'
         fi
    fi

else
    echo -n "Checking if $CC accepts -g... "
    if (
         $CC -g __conftest.c -o __conftest
       ) >/dev/null 2>&1; then
         echo 'yes'
         CFLAGS="$CFLAGS -g"
    else
         echo 'no'
    fi

fi

LDFLAGS=
LIBS=

rm -f __conftest*

##################################################

LIBTERMCAP=-ltermcap

##################################################

USE_GLIBC=1

##################################################

echo -n 'Checking for PAM... '
if [ x$WITHOUT_PAM != x ]; then
    echo disabled
else
cat <<EOF >__conftest.c
#include <stdio.h>
#include <security/pam_appl.h>
int main(void) {
    pam_start("configure", "nobody", NULL, NULL);
    return 0;
}

EOF
if (
      $CC $CFLAGS  __conftest.c -ldl -lpam -lpam_misc -o __conftest || exit 1
   ) >/dev/null 2>&1; then
        echo 'yes'
        USE_PAM=1
    else
        echo 'no'
    fi
fi
rm -f __conftest*

##################################################

if [ x$USE_PAM = x ]; then
    echo -n 'Checking for shadow... '
    if [ x$WITHOUT_SHADOW != x ]; then
        echo disabled
    else
cat <<EOF >__conftest.c
#include <stdio.h>
#include <shadow.h>
int main(void) {
    getspnam("nobody");
    return 0;
}

EOF
    if (
          $CC $CFLAGS  __conftest.c  -o __conftest || exit 1
       ) >/dev/null 2>&1; then
            echo 'yes'
            USE_SHADOW=1
            LIBSHADOW=
        else
        if (
              $CC $CFLAGS  __conftest.c -lshadow -o __conftest || exit 1
           ) >/dev/null 2>&1; then
                echo '-lshadow'
                USE_SHADOW=1
                LIBSHADOW=-lshadow
            else
                echo 'no'
            fi
        fi
    fi
fi
rm -f __conftest*

##################################################

LIBS="$LIBS -lcrypt"

##################################################
#ifneq ($(BR2_ARCH_IS_64),y)
#CFLAGS="$CFLAGS -Dsocklen_t=size_t"
#endif
##################################################

CFLAGS="$CFLAGS -D_GNU_SOURCE"

##################################################

## libbsd should go last in case it's broken
if [ "x$LIBBSD" != x ]; then
    LIBS="$LIBS $LIBBSD"
fi

echo 'Generating MCONFIG...'
(
    echo -n '# Generated by configure (confgen version 2) on '
    date
    echo '#'
    echo

    echo "BINDIR=$BINDIR"
    echo "SBINDIR=$SBINDIR"
    echo "MANDIR=$MANDIR"
    echo "BINMODE=$BINMODE"
    echo "DAEMONMODE=$DAEMONMODE"
    echo "MANMODE=$MANMODE"
    echo "SUIDMODE=$SUIDMODE"
    echo "PREFIX=$PREFIX"
    echo "EXECPREFIX=$EXECPREFIX"
    echo "INSTALLROOT=$INSTALLROOT"
    echo "CC=$CC"
    if [ x$CC_WARNINGS != x ]; then
        CFLAGS="$CFLAGS $WARNINGS"
    fi

    echo "CFLAGS=$CFLAGS" | sed 's/= */=/'
    echo "LDFLAGS=$LDFLAGS" | sed 's/= */=/'
    echo "LIBS=$LIBS" | sed 's/= */=/'

    echo "LIBTERMCAP=$LIBTERMCAP"
    echo "USE_GLIBC=$USE_GLIBC"
    echo "USE_PAM=$USE_PAM"
    echo "USE_SHADOW=$USE_SHADOW"
    echo "LIBSHADOW=$LIBSHADOW"
) > MCONFIG

